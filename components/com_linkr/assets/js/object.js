
var LinkrObject={options:{title:'Linkr',objName:'LinkrObject',selectListStyle:{margin:'0 2px'},layoutHeaderDirection:'horizontal',defaultItemid:0,cookieSettings:{duration:14,autoSave:false}},search:{defaultType:'',defaultListType:false,enableOptions:false,enableSorting:false,enableUncategorized:0,name:{},options:{},result:{},selectedType:'',sort:{},sortName:{id:'ID',title:'Title',name:'Name',date:'Date',created:'Created',modified:'Modified',ordering:'Ordering'},sql:{}},sort:{id:function(r,k){k=$pick(k,'id');return r.sort(function(a,b){return(a[k].toInt()-b[k].toInt())})},title:function(r,k){k=$pick(k,'title');return r.sort(function(a,b){return a[k]==b[k]?0:(a[k]>b[k]?1:-1)})},date:function(r,k){k=$pick(k,'date');return r.sort(function(a,b){return(b[k].replace(/(\s|:|-)/g,'')-a[k].replace(/(\s|:|-)/g,''))})},name:function(r){return this.sort.title(r,'name')},created:function(r){return this.sort.date(r,'created')},modified:function(r){return this.sort.date(r,'modified')},ordering:function(r){return this.sort.id(r,'ordering')}},layout:{_genericLayout:function(lyt){var cnt=new Element('div');var cfg=false;var tb=$pick(lyt.toolbar,0);if($type(tb)=='object')cfg=this.tmpl.insertToolbar(tb,cnt);this.tmpl.getConfig($pick(lyt.config,{})).injectInside(cnt);var inf=new Element('div',{styles:{margin:5}}).injectInside(cnt);var ll=false;var hd=$pick(lyt.header,0);if($type(hd)=='object')ll=this.tmpl.insertHeader(hd,inf);var ds=$pick(lyt.description,0);if($type(ds)=='object')this.tmpl.insertContent(ds,inf);this.display(cnt);if(cfg)this.tmpl.setupToggleLink(inf);if(ll)ll.each(function(lf){lf.call()});var r=$pick(lyt.returnPage,false);if(r){var rt=$type(r);if(rt=='string')this.setReturnPage(r);if(rt=='array')this.setReturnPage(r[0],r[1])}if($defined(lyt.onComplete)&&$type(lyt.onComplete)=='function')lyt.onComplete.attempt()},_genericLayoutDelayed:function(a,d){Linkr.delayDisplay('layout',$pick(d,70),this.layout._genericLayout.bind(this,a))},uncategorized:function(){this.setMsg('"Uncategorized" layout not set');this.display()}},tmpl:{insertToolbar:function(b,d){var bl=[];var c=false;for(l in b){if(l=='back'){bl.include([0,'&#171; '+this._('BACK').toLowerCase(),b.back])}else if(l=='config'){c=true;bl.include(['toggleConfig',this._('CONFIGURE_LINK')])}else if(l=='insert'){bl.include([0,this._('GET_LINK'),b.insert])}else if($type(b[link])=='array'){bl.include(b[link])}}Linkr.htmlTBLinks(bl).injectInside(d);return c},insertHeader:function(hd,d){var hr=new Element('div',{styles:{'margin-bottom':5}}).injectInside(d);if(this.options.layoutHeaderDirection=='vertical'){var he='div';var hs={'margin-bottom':5,'text-align':'center'}}else{var he='span';var hs={'margin-left':15}}var l=[];for(t in hd){var h=hd[t];var ht=$type(h);if(ht=='string'){new Element(he,{styles:hs}).setHTML(h).injectInside(hr)}else if(ht=='array'){var hee=new Element(he,{styles:hs}).injectInside(hr);new Element('span').setHTML(h[0]+': ').injectInside(hee);new Element('strong').setHTML(h[1]).injectInside(hee)}else if(ht=='element'){h.injectInside(hr)}else if(ht=='object'){var wrp=new Element(he,{styles:hs}).injectInside(hr);if($defined(h.label)){new Element('span').setHTML(h.label).injectInside(wrp)}new Element('span',{id:t}).setHTML(Linkr.loading).injectInside(wrp);l.include(this.loadList.create({'bind':this,'attempt':true,'arguments':[$pick(h.type,this.search.defaultType),t,$pick(h.databaseID,false),$pick(h.styles,false),$pick(h.enableUncategorized,0),$pick(h.sqlOptions,false)]}))}}return l.length>0?l:false},insertContent:function(c,d){if($defined(c.element)){c.element.injectInside(d)}else{var s=$pick(c.styles,{padding:3,'background-color':'#eeeeee'});new Element('div',{styles:s}).setHTML($pick(c.text,'')).injectInside(d)}},setupToggleLink:function(e,a,b){b=$pick(b,'settings');a=$pick(a,'toggleConfig');Linkr.createToggleLink(b,a)},getConfig:function(o){var cd=new Element('div',{id:'settings'});new Element('div',{styles:{'text-align':'center','font-weight':'bold'}}).setHTML(this._('LC_ATTRIBUTES')).injectInside(cd);this.tmpl.getLabel('linkText',this._('LC_TEXT')).injectInside(cd);this.tmpl.getInput('linkText',Linkr.getDefaultText($pick(o.text,''))).injectInside(cd);this.tmpl.clear().injectInside(cd);if($pick(o.target,true)){this.tmpl.getLabel('target',this._('LC_TARGET')).injectInside(cd);Linkr.htmlSelectCustom([['_self',this._('LC_TARGET_SELF'),'selected'],['_blank',this._('LC_TARGET_BLANK')]],{id:'target'}).injectInside(cd);this.tmpl.clear().injectInside(cd)}this.tmpl.getLabel('linkTitle',this._('LC_TITLE')).injectInside(cd);this.tmpl.getInput('linkTitle',$pick(o.linkTitle,'')).injectInside(cd);this.tmpl.clear().injectInside(cd);this.tmpl.getLabel('linkClass',this._('LC_CLASS')).injectInside(cd);this.tmpl.getInput('linkClass',$pick(o.linkClass,'')).injectInside(cd);this.tmpl.clear().injectInside(cd);this.tmpl.getLabel('linkRelation',this._('LC_RELATION')).injectInside(cd);this.tmpl.getInput('linkRelation',$pick(o.linkRelation,'')).injectInside(cd);this.tmpl.clear().injectInside(cd);var u=$pick(o.url,'index.php');var ut=$type(u);if(ut=='string')this.tmpl.getInput('linkURL',u,'hidden').injectInside(cd);if(ut=='object'&&$defined(u.list)){this.tmpl.getLabel('linkURL',$pick(u.label,'Itemid')).injectInside(cd);Linkr.htmlSelectCustom(u.list,{id:'linkURL',name:'linkURL','class':'inputbox value'}).injectInside(cd);this.tmpl.clear().injectInside(cd)}var iid=false;if(ut=='object'&&$defined(u.options)){iid=new Element('div',{id:'urlDiv'}).setHTML(Linkr.wideLoading).injectInside(cd)}var frt=$pick(o.format,false);if($type(frt)=='array'&&frt.length>0){this.tmpl.getLabel('format',this._('LC_FORMAT')).injectInside(cd);Linkr.htmlSelectCustom(frt,{id:'format'}).injectInside(cd);this.tmpl.clear().injectInside(cd)}var ans=$pick(o.anchor,0);if($type(ans)=='array'){ans=[['','-- '+this._('PICK')+' --']].merge(ans);this.tmpl.getLabel('anchor',this._('LC_ANCHOR')).injectInside(cd);Linkr.htmlSelectCustom(ans,{id:'anchor'}).injectInside(cd);this.tmpl.clear().injectInside(cd)}var pbs=$pick(o.pageBreak,0);if($type(pbs)=='array'){var cbs=[['','-- '+this._('PICK')+' --']];pbs.each(function(b,i){if(b.length>1)cbs.include([i,b])});cbs.include(['all','('+this._('ALL')+')']);this.tmpl.getLabel('pageBreak',this._('LC_PAGEBREAK')).injectInside(cd);Linkr.htmlSelectCustom(cbs,{id:'pageBreak'}).injectInside(cd);this.tmpl.clear().injectInside(cd)}if($type($pick(o.custom,0))=='object'){for(c in o.custom){var co=o.custom[c];var cot=$type(co);if(cot=='element'){co.injectInside(cd);this.tmpl.clear().injectInside(cd)}else if(cot=='array'&&co.length==2){co[0].injectInside(cd);co[1].injectInside(cd);this.tmpl.clear().injectInside(cd)}}}if(iid)this._getItemidUrls(u.query,u.options,iid,true);return cd},getLabel:function(a,b){return new Element('label',{'for':a}).setHTML(b)},getInput:function(a,b,c){return new Element('input',{id:a,name:a,value:b,type:$pick(c,'text'),'class':'inputbox value'})},clear:function(){return new Element('div',{styles:{clear:'both'}})},dbList:function(q,s,l,c,a){var d=Linkr.dbList(q,s,l,c,a);return d===false?this.home():null},dbObject:function(q,c,a){var d=Linkr.dbObject(q,c,a);return d===false?this.home():null},isError:function(o){if(!Linkr.isDBRO(o)){return'Linkr Error: Invalid database object'}if(Linkr.isError(o))return'Database Error: '+o.msg;return false},htmlAnchors:function(txt){if($type(txt)!='string'||txt.length<10)return false;var as=txt.match(/<a[^>]*name="([^"]+)"[^>]*>[^<]*<\/a>/ig);if(!as)return false;var ans=[];as.each(function(a){var s=a.indexOf('name="');var e=a.indexOf('"',s+6);ans.include(a.substring(s+6,e))});return ans},pageBreaks:function(txt){if($type(txt)!='string'||txt.length<35)return false;var bs=txt.match(/<hr[^>]*class="system-pagebreak"[^>]*\/>/ig);if(!bs)return false;var bns=[];bs.each(function(b){var s=b.indexOf('title="');var e=b.indexOf('"',s+7);bns.include(b.substring(s+7,e))});return bns}},sliders:{},getInstance:function(c,o,p,y){c=$type(c)=='object'?c:{};o=$type(o)=='object'?o:{};p=$type(p)=='object'?p:{};y=$type(y)=='object'?y:{};var copy=new Class(this);copy.implement(new Options,new Events);return new copy(c,o,p,y)},initialize:function(o,s,l,t){this.setOptions(o);this.search=$merge(this.search,$pick(s,{}));this.layout=$merge(this.layout,$pick(l,{}));this.tmpl=$merge(this.tmpl,$pick(t,{}));for(m in this.layout)this.layout[m]=this.layout[m].bind(this);for(m in this.tmpl)this.tmpl[m]=this.tmpl[m].bind(this);this.search.sortName=$merge(this.search.sortName,{title:this._('TITLE'),name:this._('NAME'),date:this._('DATE'),created:this._('CREATED'),modified:this._('MODIFIED'),ordering:this._('ORDERING')});if(this.options.initialize)this.options.initialize.call(this)},msg:[],setMsg:function(m,r){if($type(m)=='string'&&m.length>0){this.msg[this.msg.length]=m}else if($type(m)=='array'&&m.length>0){this.msg.merge(m)}return r},setReturnPage:function(m,a){var o=this.options.objName;if(o=='LinkrObject'||o=='')return this.setMsg('Invalid object name (options.objName)');if(m=='home'||m=='landing')return Linkr.setReturnPage([o,m]);if($type(this.layout[m])!='function')return this.setMsg('Invalid return page');Linkr.setReturnPage([o,'_return'],[m,a])},_return:function(p,a){if($type(this.layout[p])=='function')return this.layout[p].attempt(a,this);this.setMsg('Notice: could not load "'+p+'"');this.home()},display:function(c,e){var h=new Element('div');this.setMsg(Linkr.getAllErrors());Linkr.insertMsgDiv(this.msg,h);this.msg=[];Linkr.htmlContent(h,c,false);if(['element','string'].contains($type(e))){h.injectInside($(e).empty())}else{Linkr.htmlLayout(this.options.title,h)}},landing:function(){Linkr.delayIdleDiv('layout',this.home.bind(this))},home:function(){var cnt=new Element('div').setStyle('text-align','center');var ld=new Element('div',{id:'selectDiv'}).injectInside(cnt);new Element('span',{id:'selectList'}).setHTML(Linkr.loading).injectInside(ld);var sr=this._homeInsertSearch(cnt,ld);this.display(cnt);this.sliders.select=new Fx.Slide(ld,{duration:100});this.sliders.search=new Fx.Slide(sr[0],{duration:100}).hide();if($type(sr[1])=='element')this.sliders.options=new Fx.Slide(sr[1],{duration:100}).hide();else this.sliders.options=false;var t=this.search.defaultType;var u=this.search.enableUncategorized;u=u>0?true:false;var s=this.options.selectListStyle;this.loadList(t,'selectList',false,s,u);this.setReturnPage('home')},_homeInsertSearch:function(cDiv,sDiv){var o=this.search;new Element('span',{styles:{'margin-left':5}}).setHTML(this._('OR')+' ').injectInside(sDiv);new Element('a',{href:'javascript:void(0);',events:{click:function(e){new Event(e).stop();this.sliders.select.slideOut();this.sliders.search.slideIn.delay(100,this.sliders.search);$('query').focus()}.bind(this)}}).setHTML(this._('BTN_SEARCH')+' &#187;').injectInside(sDiv);var qDiv=new Element('div',{id:'searchDiv'}).injectInside(cDiv);var back=$pick(o.selectListText,this._('CATEGORY'));new Element('a',{href:'javascript:void(0);',styles:{'margin-right':5},events:{click:function(e){new Event(e).stop();this.sliders.search.slideOut();this.sliders.select.slideIn.delay(100,this.sliders.select)}.bind(this)}}).setHTML('&#171; '+back.toLowerCase()).injectInside(qDiv);new Element('input',{id:'query',type:'text','class':'inputbox',styles:{margin:'0 2px',width:130}}).injectInside(qDiv);if(this.isSearchMultiple()){var qol=[];var qnl=$pick(o.name,{});if(o.selectedType.length<1){var cs=this.getCookie()||{};o.selectedType=$pick(cs.st,'')}for(ty in o.sql){var n=$pick(qnl[ty],ty);var a=ty==o.selectedType?'selected':'';qol.include([ty,n,a])}Linkr.htmlSelectCustom(qol,{id:'searchType'}).injectInside(qDiv)}else{new Element('input',{id:'searchType',type:'hidden',value:(o.defaultSearchType?o.defaultSearchType:o.defaultType)}).injectInside(qDiv)}new Element('input',{type:'button',value:this._('BTN_SEARCH'),styles:{margin:'0 2px'},events:{click:function(e){new Event(e).stop();if($('query').getValue().trim().length<1)return $('query').focus();Linkr.delayIdleDiv('results',true,70);this.dbSearch.delay(90,this,true)}.bind(this)}}).injectInside(qDiv);var oDiv=false;if(o.enableOptions)oDiv=this._homeInsertOptions(cDiv,qDiv);new Element('div',{id:'results'}).injectInside(cDiv);return[qDiv,oDiv]},_homeInsertOptions:function(cDiv,sDiv){var o=this.search;if($type(o.options)!='object')return this.setMsg('Invalid search options');new Element('input',{id:'searchOptions',type:'button',value:this._('BTN_OPTIONS'),styles:{margin:'0 2px'},events:{click:function(e){new Event(e).stop();this.sliders.options.toggle()}.bind(this)}}).injectInside(sDiv);var oDiv=new Element('div',{styles:{margin:'5px 150px','text-align':'left'}}).injectInside(cDiv);var def=this.getCookie()||{};for(son in o.options){var so=o.options[son];var soId='so-'+son;var sol=$pick(so.label,son);this.tmpl.getLabel(soId,sol).injectInside(oDiv);var sos=$pick(def[son],'');sos=sos.length>1?sos:$pick(so.defaultValue,'-');var soa=[];for(soe in so.values){var val=so.values[soe];var sel=soe==sos?'selected':'';soa.include([soe,val,sel])}Linkr.htmlSelectCustom(soa,{id:soId,'class':'option-element',styles:{'text-align':'center'}}).injectInside(oDiv);this.tmpl.clear().injectInside(oDiv)}return oDiv},_getItemidUrls:function(a,b,c,z){if(z===true)return Linkr.getItemids(a,b,[this,'_getItemidUrls'],[b,c]);var e=this.tmpl.isError(a);if(e!==false)return this.display(e);var d=b.defaultURL;if(a.result.length<1)return c.replaceWith(this.tmpl.getInput('linkURL',d,'hidden'));var ul=[[d,this._('NONE')]];a.result.each(function(i,n){ul.include([d+'&Itemid='+i.id,Linkr.UTF8.Decode(i.name)+' ('+i.id+')'])});if(this.options.defaultItemid==0)ul[0].include('selected');else ul[ul.length-1].include('selected');var sl=Linkr.htmlSelectCustom(ul,{id:'linkURL',name:'linkURL','class':'inputbox value'});c.replaceWith(sl);this.tmpl.clear().injectAfter(sl);this.tmpl.getLabel('linkURL','ItemID').injectBefore(sl)},loadList:function(a,b,c,d,e,f){if($type(a)=='string'){var id=c?c.toInt():false;var sql=this._buildSQL(a,id,false,f);return Linkr.dbList(sql,0,0,[this,'loadList'],[a,b,d,e])}var err=this.tmpl.isError(a);if(err!==false)return this.display(err);if(e!==true&&e!==false){e=this.search.enableUncategorized==2?true:false}if((!a.result||a.result.length<1)&&e!==true){var list=new Element('span',{styles:{'font-weight':'bold'}}).setHTML(this._('NONE'));return $(c).replaceWith(list)}var styles=$type(d)=='object'?d:this.options.selectListStyle;var list=new Element('select',{id:c,styles:styles,events:{change:function(el){var el=$(el);if(!el)return;var id=el.getValue().toInt();if(id==0){Linkr.delayIdleDiv('results',true,70);this.layout.uncategorized.delay(90,this,true)}else if(id>-1){Linkr.delayIdleDiv('layout',true,70);this.layout[b].delay(90,this,id)}}.bind(this,c)}});var pick=this._('PICK');if(this.isSearchMultiple()&&$defined(this.search.name[b])){pick+=' ('+this.search.name[b].toLowerCase()+')'}new Element('option',{value:-1}).setHTML('-- '+pick+' --').injectInside(list);if(e===true){new Element('option',{value:0}).setHTML('-- '+this._('UNCATEGORIZED')+' --').injectInside(list)}if($type(a.result)=='array'&&a.result.length>0){a.result.each(function(o,i){var on=$pick(o.title,$pick(o.name,''));new Element('option',{value:o.id}).setHTML(Linkr.UTF8.Decode(on)).injectInside(list)})}$(c).replaceWith(list)},dbSearch:function(dbr,ty){if(dbr===true){var txt=$('query').getValue().trim();if(this.sliders.options)this.sliders.options.slideOut();var opts={};var oList=$$('.option-element');var sets=this.getCookie()||{};if(oList&&oList.length>0){oList.each(function(o){var on=o.getProperty('id').replace('so-','');opts[on]=o.getValue();sets[on]=opts[on]})}var t=$('searchType').getValue();sets.st=t;this.search.selectedType=t;this.setCookie(sets);var sql=this._buildSQL(t,false,txt,opts);var done=Linkr.dbList(sql,0,100,[this,'dbSearch'],t);return done===false?this.home():null}Linkr.delayDisplay('results',70,[this,'listResults'],[dbr,ty])},listResults:function(dbr,ty,hd){var err=this.tmpl.isError(dbr);if(err!==false)return this.display(err);if(dbr.result.length<1){return this.display(new Element('div',{styles:{'margin-top':15,'letter-spacing':3}}).setHTML(this._('NORESULTS')),'results')}var rDiv=new Element('div');if($type(hd)=='string'){var hm=hd}else{var tn=$pick(this.search.name[ty],ty);var hm=this._('SEARCH_TYPE_RESULTS',[tn,dbr.result.length])}new Element('div',{styles:{width:'100%',margin:'10px 0 7px 0','font-weight':'bold'}}).setHTML(hm).injectInside(rDiv);if(this.search.enableSorting===true)this._insertSortLinks(rDiv,ty);this.tmpl.clear().setHTML(' ').injectInside(rDiv);this.searchType=ty;this.searchResults=dbr.result;var rlist=new Element('div',{id:'rlist'});this.displayResults(false,rlist);rlist.injectInside(rDiv);this.tmpl.clear().setHTML(' ').injectInside(rDiv);this.display(rDiv,'results')},_insertSortLinks:function(rDiv,ty){var cs=$pick(this.search.sort[ty],['id','title']);if($type(cs)!='array'||cs.length<1)return;var sDiv=new Element('div',{styles:{margin:'0 0 2px 0',padding:'0 0 2px 0','border-bottom':'1px solid #eeeeee'}}).injectInside(rDiv);new Element('span').setHTML(this._('SORT_BY')+' ').injectInside(sDiv);cs.each(function(c){var n=$pick(this.search.sortName[c],c);this._getSortLink(c,n).injectInside(sDiv);new Element('span').setHTML(' &bull; ').injectInside(sDiv)},this);sDiv.getLast().remove()},displayUncategorized:Class.empty,_getSortLink:function(s,t){return new Element('a',{href:'#',id:'sort-'+s,'class':'sort-link',styles:{margin:'0 3px'},events:{click:function(e){new Event(e).stop();this.displayResults(s)}.bind(this)}}).setHTML(t)},displayResults:function(s,d){var r=this.searchResults;if($type(r)!='array'||r.length<1)return;var d=d?d:$('rlist');if($type(d)!='element')return;if(s&&$defined(this.sort[s])){r=this.sort[s].attempt([r],this)}d.empty();var ty=this.searchType;r.each(function(sr){var i=new Element('div',{styles:{margin:3,width:560,'float':'left','text-align':'left'}}).injectInside(d);var n=false;if($defined(this.search.result[ty]))var n=this.search.result[ty].attempt(sr,this);if(!n){n=$pick(sr.title,$pick(sr.name,'??'));n=Linkr.UTF8.Decode(n)}new Element('a',{href:'javascript:void(0)',events:{click:function(e){new Event(e).stop();this.layout[ty].attempt(sr.id.toInt(),this)}.bind(this)}}).setHTML('&bull; '+n).injectInside(i)},this);if(s){$$('.sort-link').each(function(el){if(el.getProperty('id')=='sort-'+s){el.setStyle('color','#666666')}else{el.setStyle('color','')}})}},isSearchMultiple:function(){if($defined(this._mstype))return this._mstype;if($type(this.search.sql)!='object'){this.search.sql={};this._mstype=false;return this.setMsg('Invalid search type',false)}this._mstype=$pick(this.search.multiple,false);this._mstype=this._mstype?true:false;return this._mstype},insert:function(){var te=$('linkText');if(!te)return this.setMsg('Missing "linkText" element');var ue=$('linkURL');if(!ue)return this.setMsg('Missing "linkURL" element');var txt=te.getValue();if(txt.trim().length==0){return alert(Linkr.missingText)}var u=ue.getValue();var fe=$('format');if(fe){var f=fe.getValue();switch(f){case'rss':case'atom':u+='&format=feed&type='+f;break;default:if(f!=''&&f!='html')u+='&format='+f}}var pb=$('pageBreak');if(pb){if(pb.getValue()=='all')u+='&showall=1';else if(pb.getValue()>0)u+='&limitstart='+pb.getValue()}var an=$('anchor');if(an&&an.getValue()!='')u+='#'+an.getValue();Linkr.link(u,txt)},link:function(){return this.insert()},_buildSQL:function(t,id,w,o){idt=$type(id);if(idt!='number'&&(idt!='string'||id.length<1))id=false;if($type(w)=='string'&&w.length>0)w=Linkr.dbQuote('%'+w.toLowerCase()+'%',true);else w=false;o=$pick(o,{});var q=false;var qo=$pick(this.search.sql[t],false);var qot=$type(qo);if(qot!='object'&&qot!='function'){var e='Invalid SQL query type "'+t+'"';return this.setMsg(e,'')}if(qot=='function'){q=qo.attempt([id,w,o],this)}if(qot=='object'){q=$pick(qo.all,'');if(w)q=$pick(qo.query,q).replace(/\[query]/g,w);if(id)q=$pick(qo.id,q).replace(/\[id]/g,id)}if($type(q)!='string'||q.length<1){var e='Invalid SQL query type "'+t+'"';return this.setMsg(e,'')}return q},getCookie:function(rc){return Linkr.getCookie(this.options.objName,this.options.cookieSettings,rc)},setCookie:function(v){return Linkr.setCookie(this.options.objName,v,this.options.cookieSettings)},UTF8en:function(str){return Linkr.UTF8.Encode(str)},UTF8de:function(str){return Linkr.UTF8.Decode(str)},_:function(t,a){return Linkr.getL18N(t,a)},dump:function(a){var dump=Linkr.dump(a,false,true);dump=dump.replace(/\n/g,'<br/>');dump=dump.replace(/\s/g,'&nbsp;');this.display(dump);return false}};